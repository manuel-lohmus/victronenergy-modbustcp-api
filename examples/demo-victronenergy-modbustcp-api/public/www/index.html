<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="author" content="Manuel Lõhmus" />
    <title>demo-victronenergy-modbustcp</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#777777">
    <!--<link async rel="icon" href="/favicon.ico">-->
    <!-- Service Worker Script -->
    <!--<script async src="node_modules/tiny-https-server"></script>-->
    <!-- bootstrap -->
    <link async rel="stylesheet" href="node_modules/bootstrap@5/dist/css/bootstrap.min.css" />
    <script async src="node_modules/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
    <link async rel="stylesheet" href="node_modules/bootstrap-icons@1/font/bootstrap-icons.css" />
    <!--Data Binding-->
    <script async src="node_modules/data-context@1"></script>
    <script async onload="start()" src="node_modules/data-context-binding@1"></script>
    <!--victronenergy-modbustcp-api-->
    <script type="text/javascript">
        function start() {

            var start = DB.Start;
            DB.Start = function () {
                DC.IsDebuger = true;
                DC.IsAutoProperty = true;
                start();
                getData(DB.BindAll);
            };
        }
        function getData(cb) {

            fetch(location.origin + "/$modbus/100?"

                // /Ac/Grid/L1+L2+L3/Power
                + "820+821+822+"
                // /Ac/Consumption/L1+L2+L3/Power
                + "817+818+819+"
                // /Dc/Battery/Power
                + "842+"
            )
                .then(res => res.json())
                .then(data => {
                    if (window.datacontext) {
                        window.datacontext.overwrite(data);
                        if (cb) { cb(); }
                    }
                    setTimeout(getData, 1000);
                });
        }
    </script>
</head>
<body>
    <div>Ac.Grid.L1.Power: <span path=".innerHTML=.Ac.Grid.L1.Power.val"></span></div>
    <div>Ac.Grid.L2.Power: <span path=".innerHTML=.Ac.Grid.L2.Power.val"></span></div>
    <div>Ac.Grid.L3.Power: <span path=".innerHTML=.Ac.Grid.L3.Power.val"></span></div>
    <div>Dc.Battery.Power: <span path=".innerHTML=.Dc.Battery.Power.val"></span></div>
</body>
</html>